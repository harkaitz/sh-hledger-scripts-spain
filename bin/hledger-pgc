#!/bin/sh -e
#l: Copyright (C) 2024  Harkaitz Agirre, harkaitz.aguirre@gmail.com
#L:
#L: This program is free software: you can redistribute it and/or modify
#L: it under the terms of the GNU General Public License as published by
#L: the Free Software Foundation, either version 3 of the License, or
#L: (at your option) any later version.
#L: 
#L: This program is distributed in the hope that it will be useful,
#L: but WITHOUT ANY WARRANTY; without even the implied warranty of
#L: MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#L: GNU General Public License for more details.
#L: 
#L: You should have received a copy of the GNU General Public License
#L: along with this program.  If not, see <https://www.gnu.org/licenses/>.
##:
#h: Usage: hledger-pgc ...
#h:
#h: Program for accounting the way PGC (Spanish Plan General de Contabilidad)
#h: dictates.
#h:
#h: Important notes:
#h:
#h:   1. Make all accounts subaccounts of those in "pgc.hledger".
#h:
#h: Subcommands:
#h:
#h: ... show    : Show configuration.
#h: ... x-inv   : Show inventory ("i" tag).
#h: ... x-bse   : Show balance sheet.
##:
hledger_pgc() {
    local cmd="$1"
    shift
    case "${cmd}" in
        show)   hledger_pgc_show_variables ;;
        x-bse)  hledger_pgc_x_bse          ;;
        x-inv)  hledger_pgc_x_inv          ;;
        *)      hledger "${cmd}" "$@";;
    esac
}
hledger_pgc_show_variables() {
    cat <<-EOF
	LEDGER_FILE : ${LEDGER_FILE}
	EOF
}
hledger_pgc_calc_variables() {
    LEDGER_FILE="${LEDGER_FILE:-${USERPROFILE:-$HOME}/.hledger.journal}"
}
## -------------------------------------------------------------------
hledger_pgc_x_bse() {
    hledger bse
}
hledger_pgc_x_inv() {
    hledger --pivot i balance
}
## -------------------------------------------------------------------
hledger() {
    env hledger --pretty=yes -s -f "${LEDGER_FILE}" "$@"
}
## -------------------------------------------------------------------
hledger_pgc_calc_variables
if test @"${SCRNAME:-$(basename "$0")}" = @"hledger-pgc"; then
    case "${1}" in
        ''|-h|--help)
            sed -n 's/^ *#h: \{0,1\}//p' "$0"
            echo
            sed -n 's/^ *#l: \{0,1\}//p' "$0"
            ;;
        *)
            hledger_pgc "$@"
            exit 0;;
    esac
fi
